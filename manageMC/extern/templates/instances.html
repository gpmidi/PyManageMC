{% extends "base.html" %}
{% load cache %}
{# Default page #}

{% block quick %}
    {% cache 60 instancesQuick1 %}
    
        {# Instance Group Listings #}
        <ul class="nav">
		    <li>By Availability</li>
	        {% for sgroup in serverStatusGroups %}
	            <li><a href="/e/instances/statusgroup/{{ sgroup }}/">{{ sgroup|capfirst }}</a></li>      
            {% endfor %}
		</ul>       
		
        {# By Status #}
        <ul class="nav">
            <li>By Status</li>
			{% for status in serverStatuses %}
			    <li><a href="/e/instances/status/{{ status.0 }}/">{{ status.1 }}</a></li>      
			{% endfor %}
        </ul>       
        
    {% endcache %}
{% endblock %}

{% block body %}
    <div class="newsbox">
        <h1>Minecraft Servers</h1>
        {% for instance in serverInstances %}
            {% cache 60 bodyInstance2 instance.pk user.is_staff %}
                 <div class="newspost">
	                 <div class="newsheader">
	                     <h2 class="newstitle">
	                         <a href="/e/instances/instance/{{ instance.name|urlencode }}/">
	                             {{ instance.humanName }}
	                         </a>
	                     </h2>
	                     <span>ID <a href="/e/instances/instance/{{ instance.name|urlencode }}/">{{ instance.name }}</a> ({{ instance.get_status_display }})</span>
	                 </div>
	                 <div class="news">  
	                     <div class="sectionbox">                      
		                     <h4>Status: </h4>
		                     {{ instance.get_status_display }}
		                     <h4>Owner: </h4>
		                         <a href="/e/users/{{ instance.owner.pk }}/" title="User Info">
		                             {% if instance.owner.get_profile.screenname %}   
			                             {{ instance.owner.get_profile.screenname }}
			                         {% else %}
			                             {{ instance.owner.username }}
			                         {% endif %}
		                         </a>
		                     </div>
	                     {% if user.is_staff %}
	                         <div class="sectionbox">
		                         <h4>Internal IP: </h4>
		                         {{ instance.internalIP }}
		                         <h4>Internal Port: </h4>
		                         {{ instance.port }}
		                         <h4>System: </h4>
		                         {{ instance.system }}
	                         </div>
	                     {% endif %}
	                     <div class="sectionbox">
		                     <h4>Connection Info</h4>
		                     <ul>
		                         {% for info in instance.serverinstanceexternalinfo_set.all %}
		                             <li>{{ info.host }}:{{ info.port }}</li>
		                         {% endfor %}
		                     </ul>
		                 </div>
		                 <div class="sectionbox">
		                     <h4>Server Admins: </h4>
		                     <ul>
		                         {% for admin in instance.admins.all %}
	                                 <li><a href="/e/users/{{ admin.pk }}/" title="User Info">
	                                     {% if admin.get_profile.screenname %}   
	                                         {{ admin.get_profile.screenname }}
	                                     {% else %}
	                                         {{ admin.username }}
	                                     {% endif %}
	                                 </a></li>
		                         {% endfor %}
		                     </ul>
		                 </div>
	                 </div>
                 </div>
            {% endcache %}
        {% endfor %}
    </div>
    
{% endblock %}
