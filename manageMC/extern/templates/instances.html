{% extends "base.html" %}
{% load cache %}
{# Default page #}

{% block quick %}
    {% cache 60 instancesQuick1 %}
    
        {# Instance Group Listings #}
        <ul class="nav nohover">
		    <li>By Availability</li>
	        {% for sgroup in serverStatusGroups %}
	            <li><a href="/e/instances/statusgroup/{{ sgroup }}/">{{ sgroup|capfirst }}</a></li>      
            {% endfor %}
		</ul>       
		
        {# By Status #}
        <ul class="nav nohover">
            <li>By Status</li>
			{% for status in serverStatuses %}
			    <li><a href="/e/instances/status/{{ status.0 }}/">{{ status.1 }}</a></li>      
			{% endfor %}
        </ul>       
        
    {% endcache %}
{% endblock %}

{% block body %}
    <div class="newsbox">
        <h1>Minecraft Servers</h1>
        {% for instance in serverInstances %}
            {% cache 60 bodyInstance1 instance.pk user.is_staff %}
                 <div class="newspost">
	                 <div>
	                     <h2 class="NewsTitle">
	                         <a href="/e/instances/instance/{{ instance.name|urlencode }}/">
	                             {{ instance.humanName }}
	                         </a>
	                     </h2>
	                     <span>ID <a href="/e/instances/instance/{{ instance.name|urlencode }}/">{{ instance.name }}</a> ({{ instance.get_status_display }})</span>
	                 </div>
	                 <div class="News">                        
	                     <b>Status: </b>{{ instance.get_status_display }}<br />
	                     <b>Owner: </b><a href="/e/users/{{ instance.owner.pk }}/" title="User Info">
	                                         {% if instance.owner.get_profile.screenname %}   
		                                         {{ instance.owner.get_profile.screenname }}
		                                     {% else %}
		                                         {{ instance.owner.username }}
		                                     {% endif %}
	                                   </a><br />
	                     {% if user.is_staff %}
	                         <div class="SectionBox">
		                         <b>Internal IP: </b> {{ instance.internalIP }}<br />
		                         <b>Internal Port: </b> {{ instance.port }}<br />
		                         <b>System: </b> {{ instance.system }}<br />
	                         </div>
	                     {% endif %}
	                     <br />
	                     
	                     <b>Connection Info</b>
	                     <ul>
	                         {% for info in instance.serverinstanceexternalinfo_set.all %}
	                             <li>{{ info.host }}:{{ info.port }}</li>
	                         {% endfor %}
	                     </ul>
	                     <b>Server Admins: </b>
	                     <ul>
	                         {% for admin in instance.admins.all %}
                                 <li><a href="/e/users/{{ admin.pk }}/" title="User Info">
                                     {% if admin.get_profile.screenname %}   
                                         {{ admin.get_profile.screenname }}
                                     {% else %}
                                         {{ admin.username }}
                                     {% endif %}
                                 </a></li>
	                         {% endfor %}
	                     </ul>
	                 </div>
                 </div>
            {% endcache %}
        {% endfor %}
    </div>
    
{% endblock %}
